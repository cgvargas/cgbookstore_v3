# CGBookStore v3 - Documento de Estado do Projeto

**Data:** 05/10/2025 - 20:30  
**VersÃ£o:** 6.1  
**Ãšltima AtualizaÃ§Ã£o:** CorreÃ§Ãµes e Melhorias na Biblioteca Pessoal

---

## VisÃ£o Geral do Projeto

**CGBookStore v3** Ã© uma livraria online desenvolvida em Django 5.0.3 com PostgreSQL (Supabase), focada em proporcionar uma experiÃªncia completa de leitura com biblioteca pessoal gamificada, sistema de eventos literÃ¡rios, integraÃ§Ã£o com Google Books API e dashboard administrativa moderna.

### Tecnologias Principais
- **Backend:** Django 5.0.3
- **Banco de Dados:** PostgreSQL 17.6 (Supabase) - Transaction Mode (porta 6543)
- **Python:** 3.13
- **Frontend:** Bootstrap 5, Font Awesome, Swiper.js
- **APIs:** Google Books API - INTEGRADO
- **Controle de VersÃ£o:** Git + GitHub

---

## Estrutura Atual do Projeto

```
C:\ProjectDjango\cgbookstore_v3\
â”œâ”€â”€ cgbookstore/              # ConfiguraÃ§Ãµes do projeto
â”‚   â”œâ”€â”€ settings.py           # Supabase Transaction Mode + Google Books API
â”‚   â”œâ”€â”€ urls.py               # Static/Media configurado
â”‚   â””â”€â”€ wsgi.py
â”‚
â”œâ”€â”€ core/                     # App principal (livraria)
â”‚   â”œâ”€â”€ models/               # MODULAR
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ category.py
â”‚   â”‚   â”œâ”€â”€ author.py         # COM FOTO + REDES SOCIAIS
â”‚   â”‚   â”œâ”€â”€ book.py
â”‚   â”‚   â”œâ”€â”€ video.py          # YouTube Shorts support
â”‚   â”‚   â”œâ”€â”€ section.py
â”‚   â”‚   â”œâ”€â”€ section_item.py
â”‚   â”‚   â””â”€â”€ event.py
â”‚   â”‚
â”‚   â”œâ”€â”€ admin/                # ADMIN MODULAR
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ author_admin.py
â”‚   â”‚   â”œâ”€â”€ book_admin.py
â”‚   â”‚   â”œâ”€â”€ category_admin.py
â”‚   â”‚   â”œâ”€â”€ event_admin.py
â”‚   â”‚   â”œâ”€â”€ section_admin.py
â”‚   â”‚   â”œâ”€â”€ video_admin.py
â”‚   â”‚   â””â”€â”€ widgets.py
â”‚   â”‚
â”‚   â”œâ”€â”€ views/                # MODULAR
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ about_view.py
â”‚   â”‚   â”œâ”€â”€ book_detail_view.py
â”‚   â”‚   â”œâ”€â”€ book_views.py   
â”‚   â”‚   â”œâ”€â”€ contact_view.py      
â”‚   â”‚   â”œâ”€â”€ dashboard_view.py 
â”‚   â”‚   â”œâ”€â”€ event_views.py
â”‚   â”‚   â”œâ”€â”€ google_books_views.py
â”‚   â”‚   â”œâ”€â”€ home_view.py
â”‚   â”‚   â”œâ”€â”€ library_view.py       
â”‚   â”‚   â”œâ”€â”€ library_ajax_views.py 
â”‚   â”‚   â””â”€â”€ search_view.py
â”‚   â”‚
â”‚   â”œâ”€â”€ management/
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â”œâ”€â”€ add_book_covers.py
â”‚   â”‚       â”œâ”€â”€ populate_db.py
â”‚   â”‚       â”œâ”€â”€ setup_supabase.py
â”‚   â”‚       â”œâ”€â”€ test_google_books.py
â”‚   â”‚       â””â”€â”€ update_covers_google.py
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ google_books_api.py
â”‚   â”‚   â””â”€â”€ supabase_storage.py
â”‚   â”‚
â”‚   â””â”€â”€ urls.py                
â”‚
â”œâ”€â”€ accounts/                 # App de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ models/               # MODULAR - Sistema de Biblioteca
â”‚   â”‚   â”œâ”€â”€ user_profile.py
â”‚   â”‚   â”œâ”€â”€ book_shelf.py     # Prateleiras de livros
â”‚   â”‚   â”œâ”€â”€ reading_progress.py
â”‚   â”‚   â””â”€â”€ book_review.py
â”‚   â”œâ”€â”€ admin.py
â”‚   â”œâ”€â”€ forms.py
â”‚   â”œâ”€â”€ views.py
â”‚   â””â”€â”€ urls.py
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.html             # Theme switcher integrado
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ base_site.html
â”‚   â”‚   â”œâ”€â”€ dashboard.html
â”‚   â”‚   â””â”€â”€ core/book/google_books_search.html
â”‚   â”œâ”€â”€ chatbot_literario/
â”‚   â”‚   â””â”€â”€ chat.html
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ about.html
â”‚   â”‚   â”œâ”€â”€ home.html
â”‚   â”‚   â”œâ”€â”€ book_list.html
â”‚   â”‚   â”œâ”€â”€ book_detail.html  # Dropdown + Modal + Prateleiras Personalizadas
â”‚   â”‚   â”œâ”€â”€ library.html      # Interface estilo Google Books
â”‚   â”‚   â”œâ”€â”€ events.html
â”‚   â”‚   â”œâ”€â”€ search_results.html
â”‚   â”‚   â””â”€â”€ widgets/event_widget.html
â”‚   â””â”€â”€ accounts/
â”‚       â”œâ”€â”€ login.html
â”‚       â””â”€â”€ register.html
â”‚
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ themes.css        # VariÃ¡veis sidebar + temas + dropdown scroll
â”‚   â”‚   â”œâ”€â”€ catalog-filters.css
â”‚   â”‚   â”œâ”€â”€ section_inline.css
â”‚   â”‚   â”œâ”€â”€ section_item_search.css
â”‚   â”‚   â””â”€â”€ themes.css
â”‚   â”‚ 
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ admin-charts.js
â”‚       â”œâ”€â”€ catalog-filters.js
â”‚       â”œâ”€â”€ library-manager.js    
â”‚       â”œâ”€â”€ section_inline.js
â”‚       â”œâ”€â”€ section_item_search.js
â”‚       â””â”€â”€ theme-switcher.js
â”‚
â”œâ”€â”€ media/                    # Configurado e funcionando
â”‚   â”œâ”€â”€ books/covers/         # 39 capas Google Books
â”‚   â”œâ”€â”€ authors/photos/
â”‚   â””â”€â”€ events/
â”‚
â””â”€â”€ documents/status/
    â””â”€â”€ status_05102025.md    # Este arquivo
```

---

## Funcionalidades Implementadas

### Core (Livraria)
- PÃ¡gina inicial com seÃ§Ãµes dinÃ¢micas gerenciÃ¡veis
- 5 seÃ§Ãµes criadas: LanÃ§amentos 2025, Fantasia, ClÃ¡ssicos, Mais Vendidos, Autores
- Widget de evento na home
- PÃ¡gina de eventos (`/eventos/`)
- CatÃ¡logo de livros com paginaÃ§Ã£o (12 por pÃ¡gina)
- BookDetailView completa
- Sistema de avaliaÃ§Ã£o com 5 estrelas
- Sistema de busca (tÃ­tulo, autor, categoria)
- PÃ¡ginas "Sobre" e "Contato"
- Upload de imagens funcionando
- NavegaÃ§Ã£o com breadcrumbs
- Livros relacionados por categoria

### Sistema de Biblioteca Pessoal (COMPLETO - 05/10/2025)

#### FASE 1 - Backend AJAX (ConcluÃ­da)
**Arquivo:** `core/views/library_ajax_views.py`
- `add_to_shelf()` - Adicionar livro a prateleira
- `remove_from_shelf()` - Remover livro
- `get_book_shelves()` - Listar prateleiras de um livro
- `create_custom_shelf()` - Validar prateleira personalizada
- `move_to_shelf()` - Mover livro entre prateleiras

**Rotas AJAX criadas:**
```
/api/library/add-to-shelf/
/api/library/remove-from-shelf/
/api/library/get-book-shelves/<id>/
/api/library/create-custom-shelf/
/api/library/move-to-shelf/
```

#### FASE 2 - Frontend JavaScript (ConcluÃ­da)
**Arquivo:** `static/js/library-manager.js`
- MÃ³dulo JavaScript completo (500+ linhas)
- Sistema de toasts personalizados (sem fundo, bordas coloridas)
- Loading states em botÃµes
- AtualizaÃ§Ã£o dinÃ¢mica de contadores
- Event delegation para elementos dinÃ¢micos
- FunÃ§Ã£o `getCookie()` para CSRF token
- AnimaÃ§Ãµes CSS (slide-in/out, fade)
- **RemoÃ§Ã£o visual de livros com fade-out**
- **DetecÃ§Ã£o automÃ¡tica de prateleira vazia**

#### FASE 3 - Book Detail (ConcluÃ­da)
**Arquivo:** `templates/core/book_detail.html`
- BotÃ£o "Adicionar Ã  Biblioteca" ativado
- Dropdown com 4 prateleiras padrÃ£o
- **Prateleiras personalizadas listadas dinamicamente**
- Ãcones coloridos (â¤ï¸ Favoritos, ğŸ“– Quero Ler, ğŸ“— Lendo, âœ… Lidos)
- Indicador visual de prateleiras atuais
- Loading states e feedback
- Auto-carrega estado ao abrir pÃ¡gina
- **Scroll automÃ¡tico no dropdown (max-height: 450px)**

#### FASE 4 - Prateleiras Personalizadas (ConcluÃ­da)
**Funcionalidades:**
- Modal Bootstrap para criar prateleira personalizada
- ValidaÃ§Ã£o de nome (nÃ£o vazio, mÃ¡x 100 caracteres)
- OpÃ§Ã£o "Nova Prateleira Personalizada" no dropdown
- BotÃ£o "Nova Prateleira" na biblioteca
- Sistema de validaÃ§Ã£o de duplicatas
- Feedback visual com toasts
- Enter para submeter formulÃ¡rio
- Prateleiras aparecem na sidebar automaticamente
- **IntegraÃ§Ã£o completa com dropdown do book_detail**

#### FASE 5 - Melhorias e CorreÃ§Ãµes (ConcluÃ­da - 05/10/2025)
**CorreÃ§Ãµes implementadas:**
1. **Dropdown com Scroll:**
   - CSS `dropdown-menu-scrollable` com max-height 450px
   - Scrollbar customizada (8px, cores adaptadas aos temas)
   - Headers sticky ao scrollar
   - Scroll aparece automaticamente com 3+ prateleiras personalizadas

2. **RemoÃ§Ã£o Visual de Livros:**
   - Card desaparece com animaÃ§Ã£o fade-out (0.3s)
   - Remove do DOM apÃ³s animaÃ§Ã£o
   - Detecta prateleira vazia automaticamente
   - Mostra mensagem "empty-shelf" com Ã­cone adequado
   - BotÃ£o "Explorar Livros" quando vazia

3. **Toast Personalizado:**
   - Fundo transparente (sem cor de fundo)
   - Bordas coloridas (2px solid)
   - Texto e Ã­cone coloridos
   - MantÃ©m cores por tipo (verde=sucesso, vermelho=erro, amarelo=aviso, azul=info)
   - Font-weight 500 para melhor legibilidade

4. **Bug Fix - custom_shelf_name:**
   - Corrigida funÃ§Ã£o wrapper `addToShelf()` no template
   - Agora aceita 3 parÃ¢metros: `(bookId, shelfType, customShelfName = '')`
   - Passa corretamente o nome da prateleira personalizada ao LibraryManager
   - ValidaÃ§Ã£o backend funcionando 100%

### Interface da Biblioteca (`/biblioteca/`)
**Layout estilo Google Books:**
- Barra lateral fixa com navegaÃ§Ã£o
- Grid de livros com capas (240px altura)
- 4 prateleiras padrÃ£o + personalizadas
- Cards estatÃ­sticos (Pontos, Livros/ano, NÃ­vel)
- Contadores em tempo real
- BotÃ£o remover ao hover
- **RemoÃ§Ã£o visual com feedback**
- Temas claro/escuro integrados
- Responsivo (mobile friendly)

**VariÃ¡veis CSS adicionadas:**
```css
--sidebar-bg: #f8f9fa (claro) / #1a1d20 (escuro)
--sidebar-stats-bg: #e9ecef (claro) / #232628 (escuro)

/* Dropdown scrollable */
.dropdown-menu-scrollable {
    max-height: 450px;
    overflow-y: auto;
}
```

### Sistema de Temas
- 3 Temas: Claro, Escuro, Sistema (auto)
- VariÃ¡veis CSS organizadas
- PersistÃªncia no localStorage
- DetecÃ§Ã£o automÃ¡tica do SO
- TransiÃ§Ãµes suaves
- Switcher visual no navbar
- Contraste otimizado
- Dropdown scrollbar adaptado aos temas

### Dashboard Admin Personalizada
- Tema escuro completo
- 6 Cards de estatÃ­sticas clicÃ¡veis
- BotÃ£o "Voltar ao Site"
- SeÃ§Ã£o de AÃ§Ãµes RÃ¡pidas
- Ãšltimos Livros + PrÃ³ximos Eventos
- 3 GrÃ¡ficos Chart.js interativos

### Google Books API Integration
- MÃ³dulo `google_books_api.py` com 10 funÃ§Ãµes
- Busca por tÃ­tulo, autor, ISBN, editora
- Download automÃ¡tico de capas
- 39/47 capas reais baixadas (83%)
- Interface Admin com paginaÃ§Ã£o
- ImportaÃ§Ã£o com um clique
- CriaÃ§Ã£o automÃ¡tica de autores/categorias

### AutenticaÃ§Ã£o
- Registro de usuÃ¡rios
- Login/Logout
- ProteÃ§Ã£o de rotas
- Navbar dinÃ¢mica
- Link Admin para staff/superuser

---

## URLs Mapeadas

| URL | View | Nome | AutenticaÃ§Ã£o |
|-----|------|------|--------------|
| `/` | HomeView | `core:home` | NÃ£o |
| `/livros/` | BookListView | `core:book_list` | NÃ£o |
| `/livros/<slug>/` | BookDetailView | `core:book_detail` | NÃ£o |
| `/biblioteca/` | LibraryView | `core:library` | **Sim** |
| `/eventos/` | EventListView | `core:events` | NÃ£o |
| `/admin/` | admin_dashboard | `admin:index` | Sim (staff) |
| `/admin/google-books/search/` | google_books_search | `admin:google_books_search` | Sim (staff) |
| `/api/library/add-to-shelf/` | add_to_shelf | `core:add_to_shelf` | Sim |
| `/api/library/remove-from-shelf/` | remove_from_shelf | `core:remove_from_shelf` | Sim |
| `/api/library/get-book-shelves/<id>/` | get_book_shelves | `core:get_book_shelves` | Sim |
| `/api/library/create-custom-shelf/` | create_custom_shelf | `core:create_custom_shelf` | Sim |
| `/api/library/move-to-shelf/` | move_to_shelf | `core:move_to_shelf` | Sim |

---

## ConfiguraÃ§Ãµes Importantes

### Banco de Dados (settings.py)
```python
import dj_database_url
from decouple import config

DATABASES = {
    'default': dj_database_url.config(
        default=config('DATABASE_URL'),
        conn_max_age=60,
        conn_health_checks=True,
    )
}
```

### VariÃ¡veis de Ambiente (.env)
```env
SECRET_KEY=Oa023568910@
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Supabase PostgreSQL - TRANSACTION MODE (porta 6543)
DATABASE_URL=postgresql://postgres.uomjbcuowfgcwhsejatn:Oa023568910@@aws-1-sa-east-1.pooler.supabase.com:6543/postgres

# Google Books API
GOOGLE_BOOKS_API_KEY=AIzaSyBF5W5NktgXZRfTnZXe3pVxqB_TCkXGzx0
```

**IMPORTANTE:** Sempre usar porta **6543** (Transaction Mode) para evitar limite de conexÃµes.

---

## PrÃ³ximas Funcionalidades Planejadas

### Prioridade ALTA

**1. Sistema de Carrinho de Compras**
   - Models: Cart, CartItem, Order
   - Adicionar/remover itens
   - Checkout bÃ¡sico
   - HistÃ³rico de pedidos

**2. Filtros AvanÃ§ados no CatÃ¡logo**
   - Filtro por categoria
   - Filtro por faixa de preÃ§o
   - OrdenaÃ§Ã£o (preÃ§o, data, tÃ­tulo, avaliaÃ§Ã£o)
   - Busca avanÃ§ada

### Prioridade MÃ‰DIA

**3. Sistema de Reviews PÃºblico**
   - ComentÃ¡rios pÃºblicos nos livros
   - Sistema de likes/dislikes
   - ModeraÃ§Ã£o

**4. Progresso de Leitura**
   - Barra de progresso visual
   - PÃ¡ginas lidas / Total
   - Estimativa de tÃ©rmino
   - EstatÃ­sticas de leitura

**5. GamificaÃ§Ã£o Completa**
   - Badges/Conquistas visuais
   - Sistema de nÃ­veis expandido
   - Desafios de leitura
   - Ranking de leitores

### Prioridade BAIXA

**6. Chatbot LiterÃ¡rio Funcional**
   - IntegraÃ§Ã£o com API (OpenAI/Ollama)
   - RecomendaÃ§Ãµes personalizadas
   - ConversaÃ§Ã£o sobre livros

**7. Sistema de SincronizaÃ§Ã£o AutomÃ¡tica**
   - Command para atualizar metadados
   - Verificar livros novos no Google Books
   - Atualizar ratings e reviews
   - Schedule com Celery

---

## Comandos Ãšteis

### Ambiente Virtual
```powershell
# Ativar
.\.venv\Scripts\activate

# Desativar
deactivate
```

### Django
```powershell
# Rodar servidor
python manage.py runserver

# Migrations
python manage.py makemigrations
python manage.py migrate

# Criar superuser
python manage.py createsuperuser

# Shell interativo
python manage.py shell

# Verificar problemas
python manage.py check

# Popular banco
python manage.py populate_db --verbose

# Atualizar capas Google Books
python manage.py update_covers_google --force --delay 0.5

# Testar Google Books API
python manage.py test_google_books --title "Harry Potter" --max-results 3
```

### Git
```powershell
git status
git add .
git commit -m "Feat: DescriÃ§Ã£o"
git push
```

---

## Ãšltimos Commits Importantes (05/10/2025)

```bash
# SessÃ£o Anterior
âœ… Feat: Sistema completo de Biblioteca Pessoal (FASES 1-4)
âœ… Feat: 5 APIs AJAX para gerenciamento de prateleiras
âœ… Feat: LibraryManager.js - MÃ³dulo JavaScript completo
âœ… Feat: Interface estilo Google Books para biblioteca
âœ… Feat: Prateleiras personalizadas funcionais
âœ… Feat: Modal de criaÃ§Ã£o de prateleiras
âœ… Feat: Dropdown de prateleiras no book_detail
âœ… Feat: Sistema de toasts para feedback visual
âœ… Fix: VariÃ¡veis CSS para sidebar (temas claro/escuro)
âœ… Style: Capas com 240px mantendo proporÃ§Ã£o
âœ… Style: Layout responsivo da biblioteca

# SessÃ£o Atual (05/10/2025)
âœ… Feat: Dropdown com scroll automÃ¡tico (max-height 450px)
âœ… Feat: Prateleiras personalizadas listadas no dropdown
âœ… Feat: RemoÃ§Ã£o visual de livros com fade-out
âœ… Feat: DetecÃ§Ã£o automÃ¡tica de prateleira vazia
âœ… Style: Toast personalizado (sem fundo, bordas coloridas)
âœ… Fix: FunÃ§Ã£o addToShelf aceita custom_shelf_name corretamente
âœ… Fix: Scrollbar customizada para dropdown
âœ… Fix: Headers sticky no dropdown scrollable
```

---

## Links Importantes

### RepositÃ³rio
- **GitHub:** https://github.com/cgvargas/cgbookstore_v3
- **Branch Principal:** main

### DocumentaÃ§Ã£o
- **Django Docs:** https://docs.djangoproject.com/en/5.0/
- **Bootstrap 5:** https://getbootstrap.com/docs/5.3/
- **Supabase Docs:** https://supabase.com/docs
- **Google Books API:** https://developers.google.com/books

### Supabase
- **Dashboard:** https://supabase.com/dashboard
- **Project:** uomjbcuowfgcwhsejatn

---

## Credenciais de Acesso

### Admin Django
- **URL:** http://127.0.0.1:8000/admin/
- **User:** admin
- **Password:** Oa023568910@

### Dashboard
- **URL:** http://127.0.0.1:8000/admin/
- **Requer:** Login como staff/superuser

### Biblioteca Pessoal
- **URL:** http://127.0.0.1:8000/biblioteca/
- **Requer:** Login de usuÃ¡rio autenticado

---

## Resumo da SessÃ£o (05/10/2025 - 20:30)

### Implementado:
1. **Dropdown com Prateleiras Personalizadas:**
   - Backend: BookDetailView passa `custom_shelves` no contexto
   - Template: Loop Django renderiza prateleiras dinamicamente
   - Scroll automÃ¡tico apÃ³s 3+ prateleiras

2. **CSS Dropdown Scrollable:**
   - Max-height: 450px
   - Scrollbar customizada (8px)
   - Headers sticky
   - Cores adaptadas aos temas

3. **RemoÃ§Ã£o Visual de Livros:**
   - AnimaÃ§Ã£o fade-out (0.3s)
   - Remove card do DOM
   - Detecta prateleira vazia
   - Mostra mensagem "empty-shelf"

4. **Toast Personalizado:**
   - Background transparente
   - Bordas coloridas (2px)
   - Texto e Ã­cone coloridos
   - MantÃ©m semÃ¢ntica (verde=sucesso, etc)

5. **Bug Fix CrÃ­tico:**
   - FunÃ§Ã£o `addToShelf()` no template corrigida
   - Aceita 3 parÃ¢metros incluindo `customShelfName`
   - Passa corretamente ao LibraryManager
   - Custom shelves funcionando 100%

### Status Atual:
- Backend: 100% funcional
- Frontend: 100% funcional
- AJAX: 5 endpoints funcionando perfeitamente
- Biblioteca: Interface completa com remoÃ§Ã£o visual
- Prateleiras Personalizadas: Totalmente integradas
- Bugs conhecidos: Nenhum

### PrÃ³xima SessÃ£o:
- **Sistema de Carrinho:** Models + Views + Templates
- **Filtros AvanÃ§ados:** CatÃ¡logo com filtros e ordenaÃ§Ã£o
- **Mover Livros:** BotÃ£o "Mover para..." nas prateleiras

---

**Ãšltima atualizaÃ§Ã£o:** 05/10/2025 - 20:30  
**Desenvolvedor:** Claude + cgvargas  
**Status:** Sistema de Biblioteca Pessoal 100% funcional