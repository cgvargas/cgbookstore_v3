# 📄 CGBookStore v3 - Documento de Estado do Projeto

**Data:** 04/10/2025 - 17:00  
**Versão:** 5.0  
**Última Atualização:** Dashboard Admin Completa + Correção de Vídeos

---

## 🎯 Visão Geral do Projeto

**CGBookStore v3** é uma livraria online desenvolvida em Django 5.0.3 com PostgreSQL (Supabase), focada em proporcionar uma experiência completa de leitura com biblioteca pessoal gamificada, sistema de eventos literários, integração com Google Books API e dashboard administrativa moderna.

### Tecnologias Principais
- **Backend:** Django 5.0.3
- **Banco de Dados:** PostgreSQL 17.6 (Supabase) ✅ **TRANSACTION MODE (porta 6543)**
- **Python:** 3.13
- **Frontend:** Bootstrap 5, Font Awesome, Swiper.js
- **APIs:** Google Books API ✅ **INTEGRADO**
- **Controle de Versão:** Git + GitHub

---

## 📂 Estrutura Atual do Projeto

```
C:\ProjectDjango\cgbookstore_v3\
├── cgbookstore/              # Configurações do projeto
│   ├── settings.py           # ✅ Supabase Transaction Mode + Google Books API
│   ├── urls.py               # ✅ Static/Media configurado
│   └── wsgi.py
│
├── core/                     # App principal (livraria)
│   ├── models/               # ✅ MODULAR
│   │   ├── __init__.py
│   │   ├── category.py
│   │   ├── author.py         # ✅ COM FOTO + REDES SOCIAIS
│   │   ├── book.py
│   │   ├── video.py          # ✅ CORRIGIDO - YouTube Shorts support
│   │   ├── section.py
│   │   ├── section_item.py
│   │   └── event.py
│   │
│   ├── admin/                # ✅ ADMIN MODULAR
│   │   ├── __init__.py       # ✅ URLs customizadas Google Books + Dashboard
│   │   ├── category_admin.py
│   │   ├── author_admin.py
│   │   ├── book_admin.py
│   │   ├── video_admin.py    # ✅ Campos editáveis
│   │   ├── section_admin.py  # ✅ Dropdown dinâmico
│   │   ├── event_admin.py
│   │   └── widgets.py
│   │
│   ├── management/           # ✅ Management Commands
│   │   ├── __init__.py
│   │   └── commands/
│   │       ├── __init__.py
│   │       ├── populate_db.py          # ✅ Popular banco
│   │       ├── add_book_covers.py      # ✅ Capas placeholder
│   │       ├── update_covers_google.py # ✅ Capas Google Books
│   │       └── test_google_books.py    # ✅ Testar API
│   │
│   ├── utils/                # ✅ Utilitários
│   │   ├── __init__.py
│   │   └── google_books_api.py  # ✅ Integração Google Books
│   │
│   ├── views/                # ✅ Modular
│   │   ├── __init__.py
│   │   ├── home_view.py
│   │   ├── book_views.py
│   │   ├── book_detail_view.py
│   │   ├── search_view.py
│   │   ├── about_view.py
│   │   ├── contact_view.py
│   │   ├── library_view.py
│   │   ├── event_views.py
│   │   ├── dashboard_view.py         # ✅ NOVO - Dashboard Admin
│   │   └── google_books_views.py     # ✅ Admin Google Books
│   │
│   ├── templatetags/         # ✅ Template tags customizados
│   │   ├── __init__.py
│   │   └── custom_filters.py # ✅ Sistema de 5 estrelas
│   │
│   ├── migrations/
│   └── urls.py
│
├── accounts/                 # App de autenticação
│   ├── forms.py
│   ├── views.py
│   ├── urls.py
│   └── admin.py
│
├── chatbot_literario/        # App do chatbot (placeholder)
│   ├── views.py
│   └── urls.py
│
├── templates/
│   ├── base.html             # ✅ Theme switcher integrado
│   ├── admin/
│   │   ├── base_site.html    # ✅ Link Google Books no navbar
│   │   ├── dashboard.html    # ✅ NOVO - Dashboard personalizada
│   │   └── core/
│   │       └── book/
│   │           └── google_books_search.html
│   ├── core/
│   │   ├── home.html         # ✅ Seções dinâmicas + Vídeos corrigidos
│   │   ├── book_list.html
│   │   ├── book_detail.html  # ✅ Adaptado aos temas
│   │   ├── search_results.html
│   │   ├── about.html
│   │   ├── contact.html
│   │   ├── library.html
│   │   ├── events.html
│   │   └── widgets/
│   │       └── event_widget.html
│   └── accounts/
│       ├── login.html
│       └── register.html
│
├── static/
│   ├── css/
│   │   ├── carousel.css
│   │   ├── section_inline.css
│   │   ├── section_item_search.css
│   │   └── themes.css
│   └── js/
│       ├── admin-charts.js
│       ├── section_inline.js
│       ├── section_item_search.js
│       └── theme-switcher.js
│
├── media/                    # ✅ Configurado e funcionando
│   ├── books/covers/         # ✅ 39 capas do Google Books + 8 placeholder
│   ├── authors/photos/
│   └── events/
│       ├── banners/
│       └── thumbnails/
│
├── documents/
│   └── status/
│       ├── status_29092025.md
│       ├── status_30092025.md
│       ├── status_02102025.md
│       ├── status_02102025_v2.md
│       ├── status_03102025_v3.md
│       ├── status_03102025_v4.md
│       └── status_04102025.md      # Este arquivo
│
├── .venv/                    # Ambiente virtual
├── .gitignore
├── requirements.txt          # ✅ Atualizado com requests
├── manage.py
└── .env                      # ✅ Transaction Mode configurado
```

---

## ✅ Funcionalidades Implementadas

### Core (Livraria)
- ✅ Página inicial com seções dinâmicas gerenciáveis pelo admin
- ✅ **5 seções criadas:** Lançamentos 2025, Fantasia, Clássicos, Mais Vendidos, Autores
- ✅ Widget de evento na home
- ✅ Página de eventos (`/eventos/`)
- ✅ Catálogo de livros com paginação (12 por página)
- ✅ BookDetailView completa
- ✅ Sistema de avaliação com 5 estrelas
- ✅ Sistema de busca (título, autor, categoria)
- ✅ Página "Sobre" institucional
- ✅ Formulário de contato
- ✅ Página de biblioteca pessoal (placeholder)
- ✅ Upload de imagens funcionando
- ✅ Navegação com breadcrumbs
- ✅ Livros relacionados por categoria

### Sistema de Temas ✨
- ✅ **3 Temas:** Claro, Escuro, Sistema (auto)
- ✅ **Variáveis CSS organizadas** para todas as cores
- ✅ **Persistência no localStorage** - tema salvo entre sessões
- ✅ **Detecção automática** de preferência do sistema operacional
- ✅ **Transições suaves** entre temas
- ✅ **Switcher visual** no navbar com dropdown
- ✅ **Contraste otimizado** em todos os componentes

### Dashboard Admin Personalizada ✨ (Implementada 04/10/2025)
- ✅ **Tema escuro completo** com variáveis CSS
- ✅ **6 Cards de estatísticas clicáveis:**
  - Total de Livros (com barra de progresso de capas)
  - Autores
  - Categorias
  - Eventos
  - Seções Ativas
  - Vídeos
- ✅ **Botão "Voltar ao Site"** no header
- ✅ **Seção de Ações Rápidas:**
  - Adicionar Livro
  - Buscar Google Books
  - Criar Evento
  - Nova Seção
- ✅ **Seção de Acesso Rápido Admin:**
  - Autenticação e Autorização
  - Core
  - Adicionar Vídeos
  - Adicionar Autores
- ✅ **Últimos Livros Adicionados** (5 mais recentes)
- ✅ **Próximos Eventos** (3 próximos)
- ✅ **Dashboard como página inicial do admin** (`/admin/`)

### Sistema de Vídeos ✨ (Corrigido 04/10/2025)
- ✅ Model Video - YouTube, Vimeo, Instagram, TikTok
- ✅ **Suporte a YouTube Shorts**
- ✅ Tipos: trailer, entrevista, resenha, tutorial
- ✅ Relacionamentos: livros e autores
- ✅ **Extração automática de embed code e thumbnail**
- ✅ **Thumbnail em alta qualidade** (maxresdefault.jpg)
- ✅ **Cards com altura fixa** na home
- ✅ **Play overlay** sobre thumbnail
- ✅ Admin completo com autocomplete
- ✅ Método `get_embed_html()` para iframe

### Sistema de Seções Dinâmicas
- ✅ Model Section - criar seções personalizadas
- ✅ Model SectionItem - associar conteúdo
- ✅ 3 tipos de layout: carrossel, grid, lista
- ✅ 3 tipos de conteúdo: livros, autores, vídeos
- ✅ Admin com preview visual dos itens
- ✅ Ordenação de seções e itens
- ✅ Ativar/Desativar seções

### Sistema de Eventos Literários
- ✅ Model Event completo
- ✅ Status automático (próximo, acontecendo, finalizado)
- ✅ Widget na home
- ✅ Página `/eventos/`
- ✅ Admin avançado com badges e ações

### Google Books API Integration ✨
- ✅ Módulo `google_books_api.py` com 10 funções
- ✅ Busca por título, autor, ISBN, editora
- ✅ Download automático de capas
- ✅ 39/47 capas reais baixadas (83% sucesso)
- ✅ **Interface Admin com paginação** (20 páginas × 10 livros = 200 livros)
- ✅ Importação automática com um clique
- ✅ Criação automática de autores e categorias
- ✅ Verificação de duplicatas por ISBN

### Autenticação
- ✅ Registro de usuários
- ✅ Login/Logout
- ✅ Proteção de rotas
- ✅ Navbar dinâmica
- ✅ Link Admin no dropdown para staff/superuser

### Sistema de Gráficos Chart.js ✨ (Implementado 04/10/2025 - Manhã)
- ✅ Módulo JavaScript modular e reutilizável
- ✅ Gráfico de barras: Livros por Categoria (TOP 10)
- ✅ Gráfico Doughnut: Eventos por Status
- ✅ Gráfico Pie: Origem das Capas
- ✅ Tema escuro integrado
- ✅ Tooltips personalizados com percentuais
- ✅ Sistema escalável para futuros gráficos

---

## 🗺️ URLs Mapeadas

| URL | View | Nome | Autenticação |
|-----|------|------|--------------|
| `/` | HomeView | `core:home` | Não |
| `/livros/` | BookListView | `core:book_list` | Não |
| `/livros/<slug>/` | BookDetailView | `core:book_detail` | Não |
| `/buscar/` | SearchView | `core:search` | Não |
| `/sobre/` | AboutView | `core:about` | Não |
| `/contato/` | ContactView | `core:contact` | Não |
| `/biblioteca/` | LibraryView | `core:library` | **Sim** |
| `/eventos/` | EventListView | `core:events` | Não |
| `/contas/login/` | LoginView | `accounts:login` | Não |
| `/contas/registrar/` | RegisterView | `accounts:register` | Não |
| `/contas/logout/` | LogoutView | `accounts:logout` | Sim |
| `/chatbot/` | ChatbotView | `chatbot:chat` | Não |
| `/admin/` | admin_dashboard | `admin:index` | Sim (staff) |
| `/admin/dashboard/` | admin_dashboard | `admin:dashboard` | Sim (staff) |
| `/admin/google-books/search/` | google_books_search | `admin:google_books_search` | Sim (staff) |
| `/admin/google-books/import/<id>/` | google_books_import | `admin:google_books_import` | Sim (staff) |

---

## 🔧 Configurações Importantes

### Banco de Dados (settings.py)
```python
import dj_database_url
from decouple import config

DATABASES = {
    'default': dj_database_url.config(
        default=config('DATABASE_URL'),
        conn_max_age=60,
        conn_health_checks=True,
    )
}
```

### Variáveis de Ambiente (.env)
```env
SECRET_KEY=Oa023568910@
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Supabase PostgreSQL - TRANSACTION MODE (porta 6543)
DATABASE_URL=postgresql://postgres.uomjbcuowfgcwhsejatn:Oa023568910@@aws-1-sa-east-1.pooler.supabase.com:6543/postgres

# Supabase API
SUPABASE_URL=https://uomjbcuowfgcwhsejatn.supabase.co
SUPABASE_ANON_KEY=eyJhbG...
SUPABASE_SERVICE_KEY=eyJhbG...

# Google Books API
GOOGLE_BOOKS_API_KEY=AIzaSyBF5W5NktgXZRfTnZXe3pVxqB_TCkXGzx0
```

**⚠️ IMPORTANTE:** Sempre usar porta **6543** (Transaction Mode) para evitar limite de conexões.

---

## 🛠️ Problemas Resolvidos na Sessão (04/10/2025)

### 1. Dashboard Admin Completa ✅
**Implementação:** 
- View com estatísticas completas
- Template com tema escuro
- 6 cards clicáveis
- Botão "Voltar ao Site"
- Seções de ações rápidas

**Status:** Resolvido - Dashboard funcionando como página inicial do admin

### 2. Paginação Google Books ✅
**Implementação:** Sistema de paginação (20 páginas × 10 livros)
**Status:** Resolvido - Navegação funcionando

### 3. Conexões Supabase ✅
**Problema:** MaxClientsInSessionMode - limite de conexões atingido
**Solução:** Alterado para Transaction Mode (porta 6543)
**Status:** Resolvido - Conexões estáveis

### 4. Vídeos sem Thumbnail ✅
**Problema:** 
- Thumbnail não sendo extraída corretamente
- YouTube Shorts não suportado
- Campos readonly impedindo edição

**Solução:**
- Método `save()` corrigido para suportar YouTube Shorts
- Campos `embed_code` e `thumbnail_url` tornados editáveis
- Template ajustado para exibir apenas thumbnail + título
- CSS com altura fixa (200px) para consistência

**Status:** Resolvido - Vídeos exibindo corretamente

---

## 🚧 Próximas Funcionalidades Planejadas

### Prioridade ALTA

**1. Gráficos Chart.js na Dashboard** 📊
   - Gráfico de livros por categoria
   - Gráfico de eventos por status
   - Gráfico de capas (Google vs Placeholder)
   - Timeline de crescimento

**2. Sistema de Biblioteca Pessoal (Backend)** 📚
   - Models: UserProfile, BookShelf, ReadingProgress, BookReview
   - CRUD de prateleiras personalizadas
   - Progresso de leitura (%)
   - Sistema de avaliações privadas

**3. Sistema de Carrinho de Compras** 🛒
   - Models: Cart, CartItem, Order
   - Adicionar/remover itens
   - Checkout básico
   - Histórico de pedidos

### Prioridade MÉDIA

**4. Filtros Avançados no Catálogo**
   - Filtro por categoria
   - Filtro por faixa de preço
   - Ordenação (preço, data, título, avaliação)
   - Busca avançada

**5. Sistema de Reviews Público**
   - Comentários públicos nos livros
   - Sistema de likes/dislikes
   - Moderação

**6. Sistema de Sincronização Automática**
   - Command para atualizar metadados de livros existentes
   - Verificar livros novos no Google Books
   - Atualizar ratings e reviews
   - Schedule com Celery (futuro)

### Prioridade BAIXA

**7. Chatbot Literário Funcional**
   - Integração com API (OpenAI/Ollama)
   - Recomendações personalizadas
   - Conversação sobre livros

**8. Gamificação**
   - Sistema de pontos por leitura
   - Conquistas (badges)
   - Ranking de leitores
   - Desafios de leitura

---

## 🎯 Conquistas da Sessão (04/10/2025)

### ✅ Dashboard Admin Completa
- Interface moderna com tema escuro
- 6 cards estatísticos clicáveis
- Botão "Voltar ao Site"
- Ações rápidas e acesso admin
- Últimos livros e próximos eventos
- Dashboard como página inicial

### ✅ Correção de Vídeos
- Suporte a YouTube Shorts
- Extração automática de thumbnail
- Cards com altura fixa (200px)
- Play overlay sobre thumbnail
- Template simplificado (só thumbnail + título)

### ✅ Correções Técnicas
- Transaction Mode Supabase (porta 6543)
- Campos editáveis no VideoAdmin
- Método `get_embed_html()` adicionado
- CSS otimizado para vídeos

### ✅ Sistema de Gráficos Chart.js
- 3 gráficos interativos implementados
- Módulo JavaScript modular (admin-charts.js)
- Integração perfeita com Dashboard
- Eventos de teste criados para validação

---

## 📋 Comandos Úteis

### Ambiente Virtual
```powershell
# Ativar
.\.venv\Scripts\activate

# Desativar
deactivate
```

### Django
```powershell
# Rodar servidor
python manage.py runserver

# Criar migrations
python manage.py makemigrations

# Aplicar migrations
python manage.py migrate

# Criar superuser
python manage.py createsuperuser

# Shell interativo
python manage.py shell

# Verificar problemas
python manage.py check

# Popular banco de dados
python manage.py populate_db --verbose

# Atualizar capas com Google Books
python manage.py update_covers_google --force --delay 0.5

# Testar Google Books API
python manage.py test_google_books --title "Harry Potter" --max-results 3
```

### Git
```powershell
git status
git add .
git commit -m "Feat: Descrição"
git push
```

---

## 🗂️ Últimos Commits Importantes

```bash
✅ Feat: Adiciona Dashboard Admin personalizada
✅ Feat: Dashboard como página inicial do admin
✅ Feat: Botão "Voltar ao Site" na dashboard
✅ Feat: 6 cards de estatísticas clicáveis
✅ Feat: Seções de ações rápidas e acesso admin
✅ Fix: Suporte a YouTube Shorts no model Video
✅ Fix: Extração automática de thumbnail para vídeos
✅ Fix: Cards de vídeo com altura fixa (200px)
✅ Fix: Conexão Supabase Transaction Mode (porta 6543)
✅ Style: Tema escuro completo na dashboard
✅ Style: Play overlay sobre thumbnails de vídeo
```

---

## 🌐 Links Importantes

### Repositório
- **GitHub:** https://github.com/cgvargas/cgbookstore_v3
- **Branch Principal:** main

### Documentação
- **Django Docs:** https://docs.djangoproject.com/en/5.0/
- **Bootstrap 5:** https://getbootstrap.com/docs/5.3/
- **Supabase Docs:** https://supabase.com/docs
- **Google Books API:** https://developers.google.com/books

### Supabase
- **Dashboard:** https://supabase.com/dashboard
- **Project:** uomjbcuowfgcwhsejatn

---

## 📋 Credenciais de Acesso

### Admin Django
- **URL:** http://127.0.0.1:8000/admin/
- **User:** admin
- **Password:** Oa023568910@

### Dashboard
- **URL:** http://127.0.0.1:8000/admin/
- **Requer:** Login como staff/superuser

### Google Books Search
- **URL:** http://127.0.0.1:8000/admin/google-books/search/
- **Requer:** Login como staff/superuser

---

## 🚀 Próximos Passos Recomendados

1. **Commit das alterações de hoje**
2. **Adicionar gráficos Chart.js na dashboard**
3. **Iniciar Sistema de Biblioteca Pessoal**
4. **Implementar Carrinho de Compras**

---

**Última atualização:** 04/10/2025 - 17:00  
**Desenvolvedor:** Claude + cgvargas  
**Status:** Em desenvolvimento ativo 🚀